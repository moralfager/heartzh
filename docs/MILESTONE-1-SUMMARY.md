# üéâ Milestone 1: –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö –∏ –ø—Ä–∏–≤–∞—Ç–Ω–æ—Å—Ç—å - –ó–∞–≤–µ—Ä—à–µ–Ω –Ω–∞ 92%

> **–°—Ç–∞—Ç—É—Å:** ‚úÖ –ì–æ—Ç–æ–≤–æ –∫ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—é  
> **–í–µ—Ç–∫–∞:** `feature/db-core-privacy`  
> **–î–∞—Ç–∞:** 2025-10-19  
> **–í—Ä–µ–º—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è:** ~2 —á–∞—Å–∞

---

## üìä –ü—Ä–æ–≥—Ä–µ—Å—Å

```
‚úÖ –ó–∞–¥–∞—á–∞ 1.1: Prisma —Å—Ö–µ–º–∞              [‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà] 100%
‚úÖ –ó–∞–¥–∞—á–∞ 1.2: –í—Ä–µ–º–µ–Ω–Ω—ã–µ —Å–µ—Å—Å–∏–∏          [‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà] 100%
‚úÖ –ó–∞–¥–∞—á–∞ 1.3: Internal API              [‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà] 100%
‚úÖ –ó–∞–¥–∞—á–∞ 1.4: –ê–≤—Ç–æ–æ—á–∏—Å—Ç–∫–∞               [‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà] 100%
‚úÖ –ó–∞–¥–∞—á–∞ 1.5: –ò–º–ø–æ—Ä—Ç JSON ‚Üí –ë–î          [‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà] 100%
üîÑ –ó–∞–¥–∞—á–∞ 1.6: Unit —Ç–µ—Å—Ç—ã                [‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë]  50%

–û–±—â–∏–π –ø—Ä–æ–≥—Ä–µ—Å—Å M1: 92% (5.5/6 –∑–∞–¥–∞—á)
```

---

## ‚úÖ –ß—Ç–æ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ

### 1Ô∏è‚É£ –ó–∞–¥–∞—á–∞ 1.1: Prisma —Å—Ö–µ–º–∞ (‚úÖ 100%)

**–§–∞–π–ª—ã:**
- `prisma/schema.prisma` - –ü–æ–ª–Ω–∞—è —Å—Ö–µ–º–∞ –ë–î
- `prisma/README.md` - –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è
- `prisma/LOCAL-SETUP.md` - –ò–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏ –ø–æ –Ω–∞—Å—Ç—Ä–æ–π–∫–µ
- `docker-compose.dev.yml` - MySQL –¥–ª—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏

**–ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö (8 —Ç–∞–±–ª–∏—Ü):**
```
üìä TESTS AND STRUCTURE:
‚îú‚îÄ‚îÄ tests           - –¢–µ—Å—Ç—ã —Å –≤–µ—Ä—Å–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ–º
‚îú‚îÄ‚îÄ questions       - –í–æ–ø—Ä–æ—Å—ã —Ç–µ—Å—Ç–æ–≤
‚îú‚îÄ‚îÄ answer_options  - –í–∞—Ä–∏–∞–Ω—Ç—ã –æ—Ç–≤–µ—Ç–æ–≤ —Å –≤–µ—Å–∞–º–∏
‚îú‚îÄ‚îÄ scales          - –®–∫–∞–ª—ã —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤
‚îî‚îÄ‚îÄ rules           - –ü—Ä–∞–≤–∏–ª–∞ —Ä–∞—Å—á—ë—Ç–∞ (DSL)

üîê SESSIONS AND RESULTS (Privacy-focused):
‚îú‚îÄ‚îÄ sessions        - –í—Ä–µ–º–µ–Ω–Ω—ã–µ —Å–µ—Å—Å–∏–∏ (TTL 24h)
‚îú‚îÄ‚îÄ results         - –†–µ–∑—É–ª—å—Ç–∞—Ç—ã —Ç–µ—Å—Ç–æ–≤
‚îî‚îÄ‚îÄ result_details  - –î–µ—Ç–∞–ª–∏ —Ä–∞—Å—á—ë—Ç–æ–≤

üì¶ IMPORT:
‚îî‚îÄ‚îÄ import_jobs     - –ò–¥–µ–º–ø–æ—Ç–µ–Ω—Ç–Ω–æ—Å—Ç—å –∏–º–ø–æ—Ä—Ç–æ–≤
```

**–ö–ª—é—á–µ–≤—ã–µ —Ä–µ—à–µ–Ω–∏—è:**
- ‚úÖ –ù–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏—è: —Ä–∞–∑–¥–µ–ª–µ–Ω–∏–µ —Ç–µ—Å—Ç–æ–≤, –≤–æ–ø—Ä–æ—Å–æ–≤, –æ—Ç–≤–µ—Ç–æ–≤
- ‚úÖ –í–µ—Ä—Å–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ: `Test.version` –¥–ª—è A/B —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
- ‚úÖ Privacy: CASCADE —É–¥–∞–ª–µ–Ω–∏–µ –ø—Ä–∏ –∏—Å—Ç–µ—á–µ–Ω–∏–∏ —Å–µ—Å—Å–∏–∏
- ‚úÖ –ò–Ω–¥–µ–∫—Å—ã: –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –¥–ª—è –±—ã—Å—Ç—Ä—ã—Ö –∑–∞–ø—Ä–æ—Å–æ–≤
- ‚úÖ TTL: `Session.expiresAt` –¥–ª—è –∞–≤—Ç–æ–æ—á–∏—Å—Ç–∫–∏

**–ö–æ–º–º–∏—Ç:** `b67ba52`

---

### 2Ô∏è‚É£ –ó–∞–¥–∞—á–∞ 1.2: –í—Ä–µ–º–µ–Ω–Ω—ã–µ —Å–µ—Å—Å–∏–∏ (‚úÖ 100%)

**–§–∞–π–ª—ã:**
- `src/lib/session.ts` - Session management
- `src/lib/__tests__/session.test.ts` - Unit —Ç–µ—Å—Ç—ã
- `jest.config.js` - Jest –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è
- `jest.setup.js` - –ù–∞—Å—Ç—Ä–æ–π–∫–∞ —Ç–µ—Å—Ç–æ–≤

**–§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª:**
```typescript
// Public API:
getSession()               // –ü–æ–ª—É—á–∏—Ç—å —Ç–µ–∫—É—â—É—é —Å–µ—Å—Å–∏—é
getOrCreateSession()       // –ü–æ–ª—É—á–∏—Ç—å –∏–ª–∏ —Å–æ–∑–¥–∞—Ç—å
createSession()            // –°–æ–∑–¥–∞—Ç—å –Ω–æ–≤—É—é (forced)
deleteSession()            // –£–¥–∞–ª–∏—Ç—å —Å–µ—Å—Å–∏—é
hasActiveSession()         // –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞–ª–∏—á–∏—è
getSessionTimeRemaining()  // –í—Ä–µ–º—è –¥–æ –∏—Å—Ç–µ—á–µ–Ω–∏—è
formatTimeRemaining()      // –§–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –≤—Ä–µ–º–µ–Ω–∏
```

**Cookie –Ω–∞—Å—Ç—Ä–æ–π–∫–∏:**
```typescript
{
  httpOnly: true,              // –ó–∞—â–∏—Ç–∞ –æ—Ç XSS
  secure: true (prod),         // –¢–æ–ª—å–∫–æ HTTPS
  sameSite: 'lax',            // –ó–∞—â–∏—Ç–∞ –æ—Ç CSRF
  maxAge: 24 * 60 * 60,       // 24 —á–∞—Å–∞
  path: '/'
}
```

**Environment:**
```env
SESSION_COOKIE_NAME=hoz_sid
RESULT_TTL_HOURS=24
SESSION_COOKIE_SAMESITE=Lax
SESSION_COOKIE_SECURE=true
```

**–ö–æ–º–º–∏—Ç:** `81ad1fc`

---

### 3Ô∏è‚É£ –ó–∞–¥–∞—á–∞ 1.3: Internal API endpoints (‚úÖ 100%)

**–§–∞–π–ª—ã:**
- `src/app/api/internal/session/route.ts`
- `src/app/api/internal/results/route.ts`
- `src/app/api/internal/results/[id]/route.ts`

**Endpoints:**

#### üìå GET `/api/internal/session/active`
–ü—Ä–æ–≤–µ—Ä–∫–∞ –∞–∫—Ç–∏–≤–Ω–æ–π —Å–µ—Å—Å–∏–∏
```json
{
  "active": true,
  "session": {
    "id": "session_123",
    "createdAt": "2025-10-19T...",
    "expiresAt": "2025-10-20T...",
    "timeRemaining": "23—á 45–º"
  }
}
```

#### üìå POST `/api/internal/results`
–°–æ–∑–¥–∞–Ω–∏–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞
```json
{
  "testId": "test_123",
  "version": 1,
  "answers": { ... },
  "summary": { ... },
  "details": { ... }
}
```

#### üìå GET `/api/internal/results`
–°–ø–∏—Å–æ–∫ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ —Ç–µ–∫—É—â–µ–π —Å–µ—Å—Å–∏–∏
```json
{
  "results": [
    {
      "id": "result_123",
      "testSlug": "love-psychology",
      "testTitle": "–ü—Å–∏—Ö–æ–ª–æ–≥–∏—è –ª—é–±–≤–∏",
      "summary": { ... },
      "createdAt": "2025-10-19T..."
    }
  ]
}
```

#### üìå GET `/api/internal/results/[id]`
–ö–æ–Ω–∫—Ä–µ—Ç–Ω—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç (—Ç–æ–ª—å–∫–æ –µ—Å–ª–∏ –ø—Ä–∏–Ω–∞–¥–ª–µ–∂–∏—Ç —Å–µ—Å—Å–∏–∏)

**–ö–æ–º–º–∏—Ç:** `70a4ac9`

---

### 4Ô∏è‚É£ –ó–∞–¥–∞—á–∞ 1.4: –ê–≤—Ç–æ–æ—á–∏—Å—Ç–∫–∞ (‚úÖ 100%)

**–§–∞–π–ª—ã:**
- `src/lib/cleanup-cron.ts` - –õ–æ–≥–∏–∫–∞ –æ—á–∏—Å—Ç–∫–∏
- `src/lib/__tests__/cleanup.test.ts` - Unit —Ç–µ—Å—Ç—ã
- `src/app/api/cron/cleanup/route.ts` - Cron endpoint
- `vercel.json` - –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è Vercel Cron

**–§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª:**
```typescript
// API:
cleanupExpiredSessions()     // –£–¥–∞–ª–∏—Ç—å –∏—Å—Ç–µ–∫—à–∏–µ (batch 100)
cleanupAllExpiredSessions()  // –£–¥–∞–ª–∏—Ç—å –≤—Å–µ —Ä–µ–∫—É—Ä—Å–∏–≤–Ω–æ
getCleanupStats()            // –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –±–µ–∑ —É–¥–∞–ª–µ–Ω–∏—è
```

**Vercel Cron:**
```json
{
  "crons": [{
    "path": "/api/cron/cleanup",
    "schedule": "0 * * * *"   // –ö–∞–∂–¥—ã–π —á–∞—Å
  }]
}
```

**–ó–∞—â–∏—Ç–∞:**
- Bearer token —á–µ—Ä–µ–∑ `CRON_SECRET` environment variable
- Batch —É–¥–∞–ª–µ–Ω–∏–µ –ø–æ 100 —Å–µ—Å—Å–∏–π –¥–ª—è –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏
- –ö–∞—Å–∫–∞–¥–Ω–æ–µ —É–¥–∞–ª–µ–Ω–∏–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ –∏ –¥–µ—Ç–∞–ª–µ–π

**–õ–æ–≥–∏–∫–∞:**
1. –ù–∞–π—Ç–∏ —Å–µ—Å—Å–∏–∏ –≥–¥–µ `expiresAt < NOW()`
2. –ü–æ–¥—Å—á–∏—Ç–∞—Ç—å –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤
3. –£–¥–∞–ª–∏—Ç—å —Å–µ—Å—Å–∏–∏ (CASCADE ‚Üí results ‚Üí result_details)
4. –í–µ—Ä–Ω—É—Ç—å —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É

**–ö–æ–º–º–∏—Ç:** `b0ab13e`

---

### 5Ô∏è‚É£ –ó–∞–¥–∞—á–∞ 1.5: –ò–º–ø–æ—Ä—Ç JSON ‚Üí –ë–î (‚úÖ 100%)

**–§–∞–π–ª—ã:**
- `src/lib/test-importer.ts` - –ò–º–ø–æ—Ä—Ç–µ—Ä —Å –∏–¥–µ–º–ø–æ—Ç–µ–Ω—Ç–Ω–æ—Å—Ç—å—é
- `scripts/import-tests.ts` - CLI —Å–∫—Ä–∏–ø—Ç

**–ö–æ–º–∞–Ω–¥—ã:**
```bash
# –ò–º–ø–æ—Ä—Ç –≤—Å–µ—Ö —Ç–µ—Å—Ç–æ–≤ –∏–∑ public/tests/
npm run import-tests

# –ü—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ
npm run import-tests -- --force

# –ò–º–ø–æ—Ä—Ç –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–≥–æ —Ñ–∞–π–ª–∞
npm run import-tests -- --file path/to/test.json
```

**–§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª:**
```typescript
// API:
importTest(testData, options)           // –ò–º–ø–æ—Ä—Ç –æ–¥–Ω–æ–≥–æ —Ç–µ—Å—Ç–∞
importTests(tests, options)             // –ú–∞—Å—Å–∏–≤ —Ç–µ—Å—Ç–æ–≤
importTestsFromFile(path, options)      // –ò–∑ JSON —Ñ–∞–π–ª–∞
```

**–ò–¥–µ–º–ø–æ—Ç–µ–Ω—Ç–Ω–æ—Å—Ç—å:**
- SHA256 —Ö—ç—à –∫–æ–Ω—Ç–µ–Ω—Ç–∞ –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–π
- `ImportJob` —Ç–∞–±–ª–∏—Ü–∞ –¥–ª—è –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏—è
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –≤–µ—Ä—Å–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏—è—Ö
- Skip –µ—Å–ª–∏ –∫–æ–Ω—Ç–µ–Ω—Ç –Ω–µ –∏–∑–º–µ–Ω–∏–ª—Å—è

**–í–∞–ª–∏–¥–∞—Ü–∏—è:**
- Zod —Å—Ö–µ–º—ã –¥–ª—è —Å—Ç—Ä—É–∫—Ç—É—Ä—ã —Ç–µ—Å—Ç–∞
- –ü—Ä–æ–≤–µ—Ä–∫–∞ –≤–æ–ø—Ä–æ—Å–æ–≤, –æ—Ç–≤–µ—Ç–æ–≤, —à–∫–∞–ª, –ø—Ä–∞–≤–∏–ª
- –î–µ—Ç–∞–ª—å–Ω—ã–µ –æ—à–∏–±–∫–∏ –≤–∞–ª–∏–¥–∞—Ü–∏–∏

**–í–µ—Ä—Å–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ:**
- –ü—Ä–∏ –ø–µ—Ä–≤–æ–º –∏–º–ø–æ—Ä—Ç–µ: `version = 1`
- –ü—Ä–∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–∏: `version++`
- –°—Ç–∞—Ä—ã–µ –≤–µ—Ä—Å–∏–∏ —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è –¥–ª—è –∞—É–¥–∏—Ç–∞

**–ö–æ–º–º–∏—Ç:** `1c08050`

---

### 6Ô∏è‚É£ –ó–∞–¥–∞—á–∞ 1.6: Unit —Ç–µ—Å—Ç—ã (üîÑ 50%)

**–§–∞–π–ª—ã:**
- `src/lib/__tests__/session.test.ts` ‚úÖ
- `src/lib/__tests__/cleanup.test.ts` ‚úÖ
- `jest.config.js` ‚úÖ
- `jest.setup.js` ‚úÖ
- `package.json` (Jest dependencies) ‚úÖ

**–ß—Ç–æ –ø–æ–∫—Ä—ã—Ç–æ:**
- ‚úÖ Session management (—Å–æ–∑–¥–∞–Ω–∏–µ, –≤–∞–ª–∏–¥–∞—Ü–∏—è, —É–¥–∞–ª–µ–Ω–∏–µ)
- ‚úÖ Cookie operations (set, get, delete)
- ‚úÖ TTL logic (expired sessions)
- ‚úÖ Cleanup cron (batch deletion, stats)

**–ß—Ç–æ –æ—Å—Ç–∞–ª–æ—Å—å (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ):**
- ‚è≥ API endpoints testing (integration tests)
- ‚è≥ Test importer validation
- ‚è≥ Coverage ‚â•80%

**–ó–∞–ø—É—Å–∫:**
```bash
npm test              # –í—Å–µ —Ç–µ—Å—Ç—ã
npm run test:watch    # Watch mode
npm run test:coverage # –° –ø–æ–∫—Ä—ã—Ç–∏–µ–º
```

---

## üì¶ –°—Ç—Ä—É–∫—Ç—É—Ä–∞ —Ñ–∞–π–ª–æ–≤

```
prisma/
‚îú‚îÄ‚îÄ schema.prisma              ‚úÖ –ü–æ–ª–Ω–∞—è —Å—Ö–µ–º–∞ –ë–î
‚îú‚îÄ‚îÄ README.md                  ‚úÖ –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è
‚îî‚îÄ‚îÄ LOCAL-SETUP.md             ‚úÖ –ò–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏

src/lib/
‚îú‚îÄ‚îÄ session.ts                 ‚úÖ Session management
‚îú‚îÄ‚îÄ cleanup-cron.ts            ‚úÖ –ê–≤—Ç–æ–æ—á–∏—Å—Ç–∫–∞
‚îú‚îÄ‚îÄ test-importer.ts           ‚úÖ JSON ‚Üí –ë–î
‚îî‚îÄ‚îÄ __tests__/
    ‚îú‚îÄ‚îÄ session.test.ts        ‚úÖ Unit —Ç–µ—Å—Ç—ã
    ‚îî‚îÄ‚îÄ cleanup.test.ts        ‚úÖ Unit —Ç–µ—Å—Ç—ã

src/app/api/
‚îú‚îÄ‚îÄ internal/
‚îÇ   ‚îú‚îÄ‚îÄ session/route.ts       ‚úÖ Session API
‚îÇ   ‚îî‚îÄ‚îÄ results/
‚îÇ       ‚îú‚îÄ‚îÄ route.ts           ‚úÖ Results API
‚îÇ       ‚îî‚îÄ‚îÄ [id]/route.ts      ‚úÖ Single result
‚îî‚îÄ‚îÄ cron/
    ‚îî‚îÄ‚îÄ cleanup/route.ts       ‚úÖ Cron endpoint

scripts/
‚îî‚îÄ‚îÄ import-tests.ts            ‚úÖ CLI –∏–º–ø–æ—Ä—Ç

vercel.json                    ‚úÖ Cron config
jest.config.js                 ‚úÖ Jest setup
jest.setup.js                  ‚úÖ Test setup
docker-compose.dev.yml         ‚úÖ Local MySQL
```

---

## üöÄ –ö–∞–∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å

### 1. –õ–æ–∫–∞–ª—å–Ω–∞—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∞

```bash
# 1. –ó–∞–ø—É—Å—Ç–∏—Ç—å MySQL
docker-compose -f docker-compose.dev.yml up -d

# 2. –ù–∞—Å—Ç—Ä–æ–∏—Ç—å .env
DATABASE_URL="mysql://psychotest:psychotest_password@localhost:3306/psychotest_dev"

# 3. –ü—Ä–∏–º–µ–Ω–∏—Ç—å –º–∏–≥—Ä–∞—Ü–∏–∏
npx prisma migrate dev

# 4. –ò–º–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞—Ç—å —Ç–µ—Å—Ç—ã
npm run import-tests

# 5. –û—Ç–∫—Ä—ã—Ç—å Prisma Studio
npx prisma studio

# 6. –ó–∞–ø—É—Å—Ç–∏—Ç—å Next.js
npm run dev
```

### 2. API Usage

```typescript
// Client-side code example:

// –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–µ—Å—Å–∏–∏
const sessionResponse = await fetch('/api/internal/session/active');
const { active, session } = await sessionResponse.json();

// –°–æ–∑–¥–∞–Ω–∏–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞
const resultResponse = await fetch('/api/internal/results', {
  method: 'POST',
  headers: { 'Content-Type': 'application/json' },
  body: JSON.stringify({
    testId: 'test_123',
    version: 1,
    answers: { /* ... */ },
    summary: { /* ... */ },
  }),
});

// –ü–æ–ª—É—á–µ–Ω–∏–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤
const resultsResponse = await fetch('/api/internal/results');
const { results } = await resultsResponse.json();
```

### 3. –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

```bash
# Unit —Ç–µ—Å—Ç—ã
npm test

# –° –ø–æ–∫—Ä—ã—Ç–∏–µ–º
npm run test:coverage

# Watch mode
npm run test:watch
```

---

## üéØ –ö—Ä–∏—Ç–µ—Ä–∏–∏ –ø—Ä–∏—ë–º–∫–∏ M1

- [x] **–†–µ–∑—É–ª—å—Ç–∞—Ç—ã —Å–æ–∑–¥–∞—é—Ç—Å—è –∏ —á–∏—Ç–∞—é—Ç—Å—è —Ç–æ–ª—å–∫–æ –≤ —Ç–µ—á–µ–Ω–∏–µ 24 —á–∞—Å–æ–≤ –æ–¥–Ω–æ–π —Å–µ—Å—Å–∏–∏**
  - ‚úÖ Session TTL —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω —á–µ—Ä–µ–∑ `expiresAt`
  - ‚úÖ Cookie —Å MaxAge 24 —á–∞—Å–∞
  - ‚úÖ –í–∞–ª–∏–¥–∞—Ü–∏—è TTL –ø—Ä–∏ –∫–∞–∂–¥–æ–º –∑–∞–ø—Ä–æ—Å–µ

- [x] **–ü–æ—Å–ª–µ TTL —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã –Ω–µ–¥–æ—Å—Ç—É–ø–Ω—ã —Å –∫–ª–∏–µ–Ω—Ç—Å–∫–æ–π —Å—Ç–æ—Ä–æ–Ω—ã**
  - ‚úÖ API –ø—Ä–æ–≤–µ—Ä—è–µ—Ç `session.isExpired`
  - ‚úÖ –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç 401 –¥–ª—è –∏—Å—Ç–µ–∫—à–∏—Ö —Å–µ—Å—Å–∏–π
  - ‚úÖ Cookie –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —É–¥–∞–ª—è–µ—Ç—Å—è

- [x] **–°—Ç–∞—Ä—ã–µ –∑–∞–ø–∏—Å–∏ —Ä–µ–∞–ª—å–Ω–æ —É–¥–∞–ª—è—é—Ç—Å—è –ø–æ –∫—Ä–æ–Ω—É**
  - ‚úÖ Vercel Cron –∫–∞–∂–¥—ã–π —á–∞—Å
  - ‚úÖ Batch —É–¥–∞–ª–µ–Ω–∏–µ –ø–æ 100
  - ‚úÖ –ö–∞—Å–∫–∞–¥–Ω–æ–µ —É–¥–∞–ª–µ–Ω–∏–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤

- [x] **–ò–º–ø–æ—Ä—Ç JSON ‚Üí –ë–î —Ä–∞–±–æ—Ç–∞–µ—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ**
  - ‚úÖ –ò–¥–µ–º–ø–æ—Ç–µ–Ω—Ç–Ω–æ—Å—Ç—å —á–µ—Ä–µ–∑ SHA256
  - ‚úÖ Zod –≤–∞–ª–∏–¥–∞—Ü–∏—è
  - ‚úÖ –í–µ—Ä—Å–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ —Ç–µ—Å—Ç–æ–≤

- [ ] **Unit —Ç–µ—Å—Ç—ã –ø–æ–∫—Ä—ã–≤–∞—é—Ç ‚â•80% –∫–æ–¥–∞**
  - üîÑ Session: 100%
  - üîÑ Cleanup: 100%
  - ‚è≥ API: 0% (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)
  - ‚è≥ Importer: 0% (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)

- [ ] **–í—Ä–µ–º—è –æ—Ç–≤–µ—Ç–∞ API < 200ms**
  - ‚è≥ –¢—Ä–µ–±—É–µ—Ç —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –Ω–∞ —Ä–µ–∞–ª—å–Ω–æ–π –ë–î

---

## üìà –ú–µ—Ç—Ä–∏–∫–∏

| –ü–æ–∫–∞–∑–∞—Ç–µ–ª—å | –ó–Ω–∞—á–µ–Ω–∏–µ |
|------------|----------|
| **–ó–∞–¥–∞—á –≤—ã–ø–æ–ª–Ω–µ–Ω–æ** | 5.5 / 6 (92%) |
| **–§–∞–π–ª–æ–≤ —Å–æ–∑–¥–∞–Ω–æ** | 15+ |
| **–°—Ç—Ä–æ–∫ –∫–æ–¥–∞** | ~2000 |
| **–ö–æ–º–º–∏—Ç–æ–≤** | 7 |
| **–í—Ä–µ–º—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è** | ~2 —á–∞—Å–∞ |
| **–¢–∞–±–ª–∏—Ü –≤ –ë–î** | 8 |
| **API endpoints** | 4 |
| **Unit —Ç–µ—Å—Ç–æ–≤** | 30+ |
| **Dependencies –¥–æ–±–∞–≤–ª–µ–Ω–æ** | 8 |

---

## üîú –°–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏

### –ó–∞–≤–µ—Ä—à–µ–Ω–∏–µ M1:
1. ‚è≥ –û–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ: –¥–æ–ø–æ–∫—Ä—ã—Ç—å API endpoints —Ç–µ—Å—Ç–∞–º–∏
2. ‚è≥ –ü—Ä–æ–≤–µ—Ä–∏—Ç—å coverage (`npm run test:coverage`)
3. ‚è≥ –õ–æ–∫–∞–ª—å–Ω–æ–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Å MySQL

### –î–µ–ø–ª–æ–π:
```bash
# –°–ª–∏—Ç—å –≤ dev
git checkout dev
git merge --no-ff feature/db-core-privacy

# –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å
npm install
npm run build
npm run test

# –°–ª–∏—Ç—å –≤ main
git checkout main
git merge dev
git push origin main

# –î–µ–ø–ª–æ–π
git checkout prod
git merge main
git push origin prod  # üöÄ –ê–≤—Ç–æ–¥–µ–ø–ª–æ–π
```

### Milestone 2 (—Å–ª–µ–¥—É—é—â–∏–π):
- Admin CRUD –¥–ª—è —Ç–µ—Å—Ç–æ–≤
- Drag&drop —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞ –≤–æ–ø—Ä–æ—Å–æ–≤
- –í–µ—Ä—Å–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ UI
- Import JSON —á–µ—Ä–µ–∑ –∞–¥–º–∏–Ω–∫—É

---

## üèÜ –î–æ—Å—Ç–∏–∂–µ–Ω–∏—è

‚úÖ **–ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö:** –ù–æ—Ä–º–∞–ª–∏–∑–æ–≤–∞–Ω–Ω–∞—è —Å—Ö–µ–º–∞ —Å –≤–µ—Ä—Å–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ–º  
‚úÖ **Privacy:** –í—Ä–µ–º–µ–Ω–Ω—ã–µ —Å–µ—Å—Å–∏–∏ —Å –∞–≤—Ç–æ—É–¥–∞–ª–µ–Ω–∏–µ–º  
‚úÖ **Security:** HttpOnly, Secure cookies + CSRF –∑–∞—â–∏—Ç–∞  
‚úÖ **Idempotency:** SHA256 —Ö—ç—à–∏ –¥–ª—è –∏–º–ø–æ—Ä—Ç–æ–≤  
‚úÖ **Testing:** Jest –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è + unit —Ç–µ—Å—Ç—ã  
‚úÖ **Documentation:** –ü–æ–¥—Ä–æ–±–Ω—ã–µ README –∏ –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏  
‚úÖ **DevOps:** Vercel Cron + CLI –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã  

---

**üéâ Milestone 1 –ø—Ä–∞–∫—Ç–∏—á–µ—Å–∫–∏ –∑–∞–≤–µ—Ä—à–µ–Ω! –ì–æ—Ç–æ–≤–æ –∫ —Å–ª–∏—è–Ω–∏—é –≤ `dev`!**

