# üö® –°–†–û–ß–ù–û–ï –ò–°–ü–†–ê–í–õ–ï–ù–ò–ï - –°–∞–π—Ç –Ω–µ –æ—Ç–≤–µ—á–∞–µ—Ç

## –ü—Ä–æ–±–ª–µ–º–∞
ERR_CONNECTION_REFUSED - —Å–µ—Ä–≤–µ—Ä –Ω–µ –æ—Ç–≤–µ—á–∞–µ—Ç

---

## üîç –®–ê–ì 1: –î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞

–ü–æ–¥–∫–ª—é—á–∏—Ç–µ—Å—å –∫ —Å–µ—Ä–≤–µ—Ä—É –∏ –≤—ã–ø–æ–ª–Ω–∏—Ç–µ:

```bash
ssh root@85.202.192.68
# –∏–ª–∏
ssh ubuntu@85.202.192.68

cd /var/www/heartzh

# –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Å—Ç–∞—Ç—É—Å –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–æ–≤
sudo docker ps -a
```

### –û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç:
–î–æ–ª–∂–Ω–æ –±—ã—Ç—å 4 –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞ –≤ —Å—Ç–∞—Ç—É—Å–µ `Up`:
- heartzh-psychotest-1
- heartzh-nginx-1
- heartzh-mysql-1 (–∏–ª–∏ –Ω–µ –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å, –º—ã –µ–≥–æ —É–±—Ä–∞–ª–∏)
- heartzh-watchtower-1

---

## üîß –®–ê–ì 2: –í–æ–∑–º–æ–∂–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã –∏ —Ä–µ—à–µ–Ω–∏—è

### –ü—Ä–æ–±–ª–µ–º–∞ –ê: –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã –Ω–µ –∑–∞–ø—É—â–µ–Ω—ã

```bash
cd /var/www/heartzh
sudo docker compose -f docker-compose.prod.yml up -d
sudo docker ps
```

### –ü—Ä–æ–±–ª–µ–º–∞ –ë: Nginx –Ω–µ –∑–∞–ø—É—Å—Ç–∏–ª—Å—è

```bash
# –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏ Nginx
sudo docker compose -f docker-compose.prod.yml logs nginx

# –ï—Å–ª–∏ –æ—à–∏–±–∫–∞ –≤ –∫–æ–Ω—Ñ–∏–≥–µ - –ø—Ä–æ–≤–µ—Ä—å—Ç–µ
sudo docker exec heartzh-nginx-1 nginx -t

# –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç–µ Nginx
sudo docker compose -f docker-compose.prod.yml restart nginx
```

### –ü—Ä–æ–±–ª–µ–º–∞ –í: –ü—Å–∏—Ö–æ—Ç–µ—Å—Ç –Ω–µ –∑–∞–ø—É—Å—Ç–∏–ª—Å—è (–æ—à–∏–±–∫–∞ –ë–î)

```bash
# –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏
sudo docker compose -f docker-compose.prod.yml logs psychotest

# –ï—Å–ª–∏ –æ—à–∏–±–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ –ë–î:
# 1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ DATABASE_URL –≤ .env
sudo cat /var/www/heartzh/.env | grep DATABASE_URL

# 2. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —á—Ç–æ MySQL –¥–æ—Å—Ç—É–ø–Ω–∞
mysql -u psychotest_user -p -h 172.17.0.1 psychotest_production

# 3. –ü—Ä–∏–º–µ–Ω–∏—Ç–µ –º–∏–≥—Ä–∞—Ü–∏–∏
cd /var/www/heartzh
sudo npx prisma migrate deploy

# 4. –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç–µ
sudo docker compose -f docker-compose.prod.yml restart psychotest
```

### –ü—Ä–æ–±–ª–µ–º–∞ –ì: –ü–æ—Ä—Ç—ã –∑–∞–Ω—è—Ç—ã

```bash
# –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —á—Ç–æ –ø–æ—Ä—Ç—ã 80 –∏ 443 —Å–≤–æ–±–æ–¥–Ω—ã
sudo netstat -tlnp | grep -E ':(80|443)'

# –ï—Å–ª–∏ –∑–∞–Ω—è—Ç–æ - –Ω–∞–π–¥–∏—Ç–µ —á—Ç–æ –∑–∞–Ω–∏–º–∞–µ—Ç
sudo lsof -i :80
sudo lsof -i :443

# –û—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ –∫–æ–Ω—Ñ–ª–∏–∫—Ç—É—é—â–∏–π –ø—Ä–æ—Ü–µ—Å—Å –∏–ª–∏ –∏–∑–º–µ–Ω–∏—Ç–µ –ø–æ—Ä—Ç—ã
```

---

## üöÄ –®–ê–ì 3: –ü–æ–ª–Ω—ã–π –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫

–ï—Å–ª–∏ –Ω–∏—á–µ–≥–æ –Ω–µ –ø–æ–º–æ–≥–∞–µ—Ç:

```bash
cd /var/www/heartzh

# –û—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ –≤—Å—ë
sudo docker compose -f docker-compose.prod.yml down

# –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —á—Ç–æ –ø–æ—Ä—Ç—ã —Å–≤–æ–±–æ–¥–Ω—ã
sudo netstat -tlnp | grep -E ':(80|443|3000)'

# –ó–∞–ø—É—Å—Ç–∏—Ç–µ –∑–∞–Ω–æ–≤–æ
sudo docker compose -f docker-compose.prod.yml up -d

# –ü–æ–¥–æ–∂–¥–∏—Ç–µ 30 —Å–µ–∫—É–Ω–¥
sleep 30

# –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Å—Ç–∞—Ç—É—Å
sudo docker ps

# –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏
sudo docker compose -f docker-compose.prod.yml logs --tail=50
```

---

## üìä –®–ê–ì 4: –ü—Ä–æ–≤–µ—Ä–∫–∞ –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏

```bash
# –° —Å–µ—Ä–≤–µ—Ä–∞ –ø—Ä–æ–≤–µ—Ä—å—Ç–µ —á—Ç–æ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –æ—Ç–≤–µ—á–∞–µ—Ç
curl http://localhost:3000
curl http://localhost:80

# –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –∏–∑ –≤–Ω–µ—à–Ω–µ–≥–æ –º–∏—Ä–∞
curl http://85.202.192.68
```

---

## üî• –ë–´–°–¢–†–û–ï –†–ï–®–ï–ù–ò–ï (–µ—Å–ª–∏ –Ω—É–∂–Ω–æ —Å—Ä–æ—á–Ω–æ)

```bash
cd /var/www/heartzh

# 1. –û—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ –∏ —É–¥–∞–ª–∏—Ç–µ –≤—Å–µ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã
sudo docker compose -f docker-compose.prod.yml down -v

# 2. –ü–µ—Ä–µ—Å–æ–±–µ—Ä–∏—Ç–µ –∏ –∑–∞–ø—É—Å—Ç–∏—Ç–µ
sudo docker compose -f docker-compose.prod.yml up -d --build

# 3. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏
sudo docker compose -f docker-compose.prod.yml logs -f

# –ù–∞–∂–º–∏—Ç–µ Ctrl+C –∫–æ–≥–¥–∞ —É–≤–∏–¥–∏—Ç–µ "Server listening on port 3000"

# 4. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Å–∞–π—Ç
curl http://localhost
```

---

## üìã –ß–µ–∫–ª–∏—Å—Ç –ø—Ä–æ–≤–µ—Ä–∫–∏

- [ ] `docker ps` –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã –≤ —Å—Ç–∞—Ç—É—Å–µ Up
- [ ] –õ–æ–≥–∏ –ø—Å–∏—Ö–æ—Ç–µ—Å—Ç–∞ –Ω–µ –ø–æ–∫–∞–∑—ã–≤–∞—é—Ç –æ—à–∏–±–æ–∫ –ë–î
- [ ] –õ–æ–≥–∏ Nginx –Ω–µ –ø–æ–∫–∞–∑—ã–≤–∞—é—Ç –æ—à–∏–±–æ–∫
- [ ] `curl http://localhost:3000` –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç HTML
- [ ] `curl http://localhost` –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç HTML
- [ ] –ü–æ—Ä—Ç—ã 80 –∏ 443 —Å–ª—É—à–∞—é—Ç—Å—è
- [ ] –°–∞–π—Ç –æ—Ç–∫—Ä—ã–≤–∞–µ—Ç—Å—è –≤ –±—Ä–∞—É–∑–µ—Ä–µ

---

## üÜò –ï—Å–ª–∏ –≤—Å—ë —Ä–∞–≤–Ω–æ –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç

–°–∫–æ–ø–∏—Ä—É–π—Ç–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã –∫–æ–º–∞–Ω–¥:

```bash
# 1. –°—Ç–∞—Ç—É—Å –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–æ–≤
sudo docker ps -a

# 2. –õ–æ–≥–∏
sudo docker compose -f docker-compose.prod.yml logs --tail=100

# 3. –ü–æ—Ä—Ç—ã
sudo netstat -tlnp | grep -E ':(80|443|3000)'

# 4. –¢–µ—Å—Ç –∏–∑–Ω—É—Ç—Ä–∏
curl -v http://localhost:3000
```

–ò –ø–æ–∫–∞–∂–∏—Ç–µ –º–Ω–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã!

---

## üí° –í–µ—Ä–æ—è—Ç–Ω–∞—è –ø—Ä–∏—á–∏–Ω–∞

–°–∫–æ—Ä–µ–µ –≤—Å–µ–≥–æ –æ–¥–∏–Ω –∏–∑ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–æ–≤ –Ω–µ –∑–∞–ø—É—Å—Ç–∏–ª—Å—è –∏–∑-–∑–∞:
1. **–û—à–∏–±–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ –ë–î** ‚Üí –ø—Ä–æ–≤–µ—Ä—å—Ç–µ DATABASE_URL
2. **Nginx –Ω–µ –º–æ–∂–µ—Ç –∑–∞–ø—É—Å—Ç–∏—Ç—å—Å—è** ‚Üí –ø—Ä–æ–≤–µ—Ä—å—Ç–µ –∫–æ–Ω—Ñ–∏–≥
3. **–ü–æ—Ä—Ç—ã –∑–∞–Ω—è—Ç—ã** ‚Üí –æ—Å–≤–æ–±–æ–¥–∏—Ç–µ –∏–ª–∏ –∏–∑–º–µ–Ω–∏—Ç–µ –ø–æ—Ä—Ç—ã
4. **Build failed** ‚Üí –ø–µ—Ä–µ—Å–æ–±–µ—Ä–∏—Ç–µ –æ–±—Ä–∞–∑—ã

**–í—ã–ø–æ–ª–Ω–∏—Ç–µ –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫—É –∏ –Ω–∞–ø–∏—à–∏—Ç–µ —á—Ç–æ –ø–æ–∫–∞–∑–∞–ª–æ!** üîß





