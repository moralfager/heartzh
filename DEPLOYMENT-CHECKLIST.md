# üöÄ Deployment Checklist - Egg Integration

## ‚úÖ –ì–æ—Ç–æ–≤–æ –Ω–∞ –ª–æ–∫–∞–ª—å–Ω–æ–π –º–∞—à–∏–Ω–µ

- [x] –£—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω—ã –≤—Å–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ (`npm install`)
- [x] –°–æ–∑–¥–∞–Ω–∞ —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ `/src/app/egg/`
- [x] –ü–µ—Ä–µ–º–µ—â–µ–Ω—ã –≤—Å–µ —Ñ–∞–π–ª—ã –∏–∑ `egg/` –≤ `src/app/egg/`
- [x] –û–±–Ω–æ–≤–ª–µ–Ω—ã –≤—Å–µ –∏–º–ø–æ—Ä—Ç—ã –∏ –ø—É—Ç–∏
- [x] –°–æ–∑–¥–∞–Ω –∏–∑–æ–ª–∏—Ä–æ–≤–∞–Ω–Ω—ã–π layout –¥–ª—è egg
- [x] –î–æ–±–∞–≤–ª–µ–Ω–∞ –∫–Ω–æ–ø–∫–∞ –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü—É `/about`
- [x] –û–±–Ω–æ–≤–ª–µ–Ω `env.production.template` —Å JWT_SECRET
- [x] –û–±–Ω–æ–≤–ª–µ–Ω `tsconfig.json` –¥–ª—è –∏—Å–∫–ª—é—á–µ–Ω–∏—è –ø–∞–ø–∫–∏ `egg/`
- [x] –û–±–Ω–æ–≤–ª–µ–Ω `next.config.js` –¥–ª—è –∏—Å–∫–ª—é—á–µ–Ω–∏—è –ø–∞–ø–∫–∏ `egg/`
- [x] –ü—Ä–æ–µ–∫—Ç —É—Å–ø–µ—à–Ω–æ —Å–æ–±–∏—Ä–∞–µ—Ç—Å—è (`npm run build`)
- [x] –ù–µ—Ç –æ—à–∏–±–æ–∫ TypeScript
- [x] –ù–µ—Ç –æ—à–∏–±–æ–∫ –ª–∏–Ω—Ç–µ—Ä–∞

## üìã –ù—É–∂–Ω–æ —Å–¥–µ–ª–∞—Ç—å –ø–µ—Ä–µ–¥ –¥–µ–ø–ª–æ–µ–º

### 1. –ù–∞ —Å–µ—Ä–≤–µ—Ä–µ –æ–±–Ω–æ–≤–∏—Ç—å `.env.production`

```bash
# SSH –Ω–∞ —Å–µ—Ä–≤–µ—Ä
ssh root@85.202.192.68

# –ü–µ—Ä–µ–π—Ç–∏ –≤ –ø—Ä–æ–µ–∫—Ç
cd /var/www/heartofzharu

# –î–æ–±–∞–≤–∏—Ç—å JWT_SECRET –≤ .env.production
nano .env.production
```

–î–æ–±–∞–≤–∏—Ç—å —Å—Ç—Ä–æ–∫—É:
```bash
# –ì–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å —Å–∏–ª—å–Ω—ã–π –∫–ª—é—á (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ):
JWT_SECRET=$(openssl rand -base64 32)

# –ò–ª–∏ –≤—Ä—É—á–Ω—É—é –¥–æ–±–∞–≤–∏—Ç—å –≤ .env.production:
JWT_SECRET="your-super-secret-jwt-key-at-least-32-chars-long"
```

–°–æ—Ö—Ä–∞–Ω–∏—Ç—å –∏ –≤—ã–π—Ç–∏ (Ctrl+O, Enter, Ctrl+X).

### 2. –ó–∞–∫–æ–º–º–∏—Ç–∏—Ç—å –∏–∑–º–µ–Ω–µ–Ω–∏—è

```bash
# –ù–∞ –ª–æ–∫–∞–ª—å–Ω–æ–π –º–∞—à–∏–Ω–µ
git add .
git commit -m "feat: integrate Heart of Zh.A. romantic quest at /egg route"
git push origin prod
```

### 3. –î–æ–∂–¥–∞—Ç—å—Å—è –¥–µ–ø–ª–æ—è

GitHub Actions –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏:
1. –°–æ–±–µ—Ä—ë—Ç Docker –æ–±—Ä–∞–∑ —Å egg –ø—Ä–æ–µ–∫—Ç–æ–º ‚ú®
2. –ó–∞–ø—É—à–∏—Ç –≤ GHCR üì¶
3. –ó–∞–¥–µ–ø–ª–æ–∏—Ç –Ω–∞ —Å–µ—Ä–≤–µ—Ä üöÄ

–°–ª–µ–¥–∏—Ç—å –∑–∞ –ø—Ä–æ–≥—Ä–µ—Å—Å–æ–º: https://github.com/moralfager/heartzh/actions

## üß™ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –ø–æ—Å–ª–µ –¥–µ–ø–ª–æ—è

### –û–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ –ø—Ä–æ–≤–µ—Ä–∫–∏:

```bash
# 1. –ì–ª–∞–≤–Ω–∞—è —Å—Ç—Ä–∞–Ω–∏—Ü–∞ egg
curl https://heartofzha.ru/egg
# –î–æ–ª–∂–Ω–æ –≤–µ—Ä–Ω—É—Ç—å HTML —Å "Heart of Zh.A."

# 2. API health check
curl https://heartofzha.ru/api/health
# –î–æ–ª–∂–Ω–æ –≤–µ—Ä–Ω—É—Ç—å {"status":"ok"}

# 3. –ì–µ–Ω–µ—Ä–∞—Ü–∏—è QR –∫–æ–¥–∞
curl -I https://heartofzha.ru/api/egg/qr-generate?format=image
# –î–æ–ª–∂–Ω–æ –≤–µ—Ä–Ω—É—Ç—å Content-Type: image/png

# 4. –°—Ç—Ä–∞–Ω–∏—Ü–∞ about
curl https://heartofzha.ru/about | grep "–ü–æ–¥–∞—Ä–æ–∫ –¥–ª—è –ñ–∞–Ω–∏—è—Ç"
# –î–æ–ª–∂–Ω–æ –Ω–∞–π—Ç–∏ —Ç–µ–∫—Å—Ç
```

### –í –±—Ä–∞—É–∑–µ—Ä–µ:

1. **–û—Ç–∫—Ä—ã—Ç—å –≥–ª–∞–≤–Ω—É—é**: https://heartofzha.ru/egg
   - [ ] –°—Ç—Ä–∞–Ω–∏—Ü–∞ –∑–∞–≥—Ä—É–∂–∞–µ—Ç—Å—è
   - [ ] –ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç—Å—è —Å–µ—Ä–¥—Ü–µ ‚ù§Ô∏è
   - [ ] –ï—Å—Ç—å –∫–Ω–æ–ø–∫–∞ "–ù–∞—á–∞—Ç—å –ø—É—Ç–µ—à–µ—Å—Ç–≤–∏–µ"
   - [ ] –†–æ–∑–æ–≤—ã–π/–ª–∞–≤–∞–Ω–¥–æ–≤—ã–π –¥–∏–∑–∞–π–Ω

2. **–ü—Ä–æ–≤–µ—Ä–∏—Ç—å –∫–Ω–æ–ø–∫—É –≤ About**: https://heartofzha.ru/about
   - [ ] –ü—Ä–æ–∫—Ä—É—Ç–∏—Ç—å –≤–Ω–∏–∑
   - [ ] –í–∏–¥–Ω–∞ –∫–∞—Ä—Ç–æ—á–∫–∞ "–ü–æ–¥–∞—Ä–æ–∫ –¥–ª—è –ñ–∞–Ω–∏—è—Ç"
   - [ ] –ö–ª–∏–∫ –≤–µ–¥—ë—Ç –Ω–∞ `/egg`

3. **–ù–∞—á–∞—Ç—å –∫–≤–µ—Å—Ç**:
   - [ ] –ù–∞–∂–∞—Ç—å "–ù–∞—á–∞—Ç—å –ø—É—Ç–µ—à–µ—Å—Ç–≤–∏–µ"
   - [ ] –û—Ç–∫—Ä—ã–≤–∞–µ—Ç—Å—è –ì–ª–∞–≤–∞ 1
   - [ ] –ï—Å—Ç—å –∞—É–¥–∏–æ –∫–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä
   - [ ] –ú–æ–∂–Ω–æ –≤–≤–µ—Å—Ç–∏ –∫–æ–¥

4. **–ü—Ä–æ–≤–µ—Ä–∏—Ç—å –∞—É–¥–∏–æ**:
   - [ ] –ù–∞–∂–∞—Ç—å –Ω–∞ –∏–∫–æ–Ω–∫—É –∑–≤—É–∫–∞
   - [ ] –ê—É–¥–∏–æ –≤–æ—Å–ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç—Å—è
   - [ ] –ú–æ–∂–Ω–æ –≤–∫–ª—é—á–∏—Ç—å/–≤—ã–∫–ª—é—á–∏—Ç—å

5. **–ü—Ä–æ–≤–µ—Ä–∏—Ç—å –∫–∞—Ä—Ç—É**:
   - [ ] –ü–µ—Ä–µ–π—Ç–∏ –Ω–∞ `/egg/map`
   - [ ] –ü–æ–∫–∞–∑—ã–≤–∞—é—Ç—Å—è –≤—Å–µ –≥–ª–∞–≤—ã
   - [ ] –ò–Ω–¥–∏–∫–∞—Ç–æ—Ä—ã —Å—Ç–∞—Ç—É—Å–∞ —Ä–∞–±–æ—Ç–∞—é—Ç

6. **–ü—Ä–æ–≤–µ—Ä–∏—Ç—å –∏–∑–æ–ª—è—Ü–∏—é —Å—Ç–∏–ª–µ–π**:
   - [ ] –û—Ç–∫—Ä—ã—Ç—å `/` (–≥–ª–∞–≤–Ω–∞—è psychotest)
   - [ ] –û—Ç–∫—Ä—ã—Ç—å `/egg` (egg –ø—Ä–æ–µ–∫—Ç)
   - [ ] –°—Ç–∏–ª–∏ –Ω–µ —Å–º–µ—à–∏–≤–∞—é—Ç—Å—è
   - [ ] –ö–∞–∂–¥—ã–π –ø—Ä–æ–µ–∫—Ç –≤—ã–≥–ª—è–¥–∏—Ç –ø—Ä–∞–≤–∏–ª—å–Ω–æ

## üîß –ï—Å–ª–∏ —á—Ç–æ-—Ç–æ –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç

### JWT_SECRET –Ω–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω

**–°–∏–º–ø—Ç–æ–º**: –û—à–∏–±–∫–∞ –ø—Ä–∏ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ —Ç–æ–∫–µ–Ω–æ–≤
```
Error: JWT_SECRET is not defined
```

**–†–µ—à–µ–Ω–∏–µ**: –î–æ–±–∞–≤–∏—Ç—å JWT_SECRET –≤ `.env.production` –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ

```bash
ssh root@85.202.192.68
cd /var/www/heartofzha.ru
echo 'JWT_SECRET="'$(openssl rand -base64 32)'"' >> .env.production
docker compose -f docker-compose.prod.yml restart psychotest
```

### –ê—É–¥–∏–æ –Ω–µ –≤–æ—Å–ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç—Å—è

**–°–∏–º–ø—Ç–æ–º**: –û—à–∏–±–∫–∞ 404 –¥–ª—è `/egg/audio/ambient-main.mp3`

**–ü—Ä–æ–≤–µ—Ä–∫–∞**: –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —á—Ç–æ —Ñ–∞–π–ª—ã —Å–∫–æ–ø–∏—Ä–æ–≤–∞–ª–∏—Å—å
```bash
ssh root@85.202.192.68
docker compose -f docker-compose.prod.yml exec psychotest ls -la /app/public/egg/audio/
```

**–†–µ—à–µ–Ω–∏–µ**: –ï—Å–ª–∏ —Ñ–∞–π–ª–æ–≤ –Ω–µ—Ç, –∑–Ω–∞—á–∏—Ç –æ–Ω–∏ –Ω–µ –±—ã–ª–∏ –≤ git. –î–æ–±–∞–≤–∏—Ç—å –∏ –∑–∞–¥–µ–ø–ª–æ–∏—Ç—å —Å–Ω–æ–≤–∞.

### –°—Ç–∏–ª–∏ –Ω–µ –ø—Ä–∏–º–µ–Ω—è—é—Ç—Å—è

**–°–∏–º–ø—Ç–æ–º**: Egg —Å—Ç—Ä–∞–Ω–∏—Ü–∞ –≤—ã–≥–ª—è–¥–∏—Ç –±–µ–∑ —Å—Ç–∏–ª–µ–π

**–ü—Ä–æ–≤–µ—Ä–∫–∞**: –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —á—Ç–æ globals.css –µ—Å—Ç—å
```bash
ssh root@85.202.192.68
docker compose -f docker-compose.prod.yml exec psychotest cat /app/src/app/egg/globals.css | head -20
```

**–†–µ—à–µ–Ω–∏–µ**: –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç—å –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä –∏–ª–∏ –ø–µ—Ä–µ—Å–æ–±—Ä–∞—Ç—å –æ–±—Ä–∞–∑.

### 404 –Ω–∞ /egg

**–°–∏–º–ø—Ç–æ–º**: –°—Ç—Ä–∞–Ω–∏—Ü–∞ –Ω–µ –Ω–∞–π–¥–µ–Ω–∞

**–ü—Ä–æ–≤–µ—Ä–∫–∞**: 
```bash
ssh root@85.202.192.68
docker compose -f docker-compose.prod.yml exec psychotest ls -la /app/src/app/egg/
```

**–†–µ—à–µ–Ω–∏–µ**: –§–∞–π–ª—ã –Ω–µ –ø–æ–ø–∞–ª–∏ –≤ –æ–±—Ä–∞–∑. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —á—Ç–æ –∫–æ–º–º–∏—Ç –±—ã–ª –ø—Ä–∞–≤–∏–ª—å–Ω–æ –∑–∞–ø—É—à–µ–Ω.

## üìä –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥

–ü–æ—Å–ª–µ —É—Å–ø–µ—à–Ω–æ–≥–æ –¥–µ–ø–ª–æ—è —Å–ª–µ–¥–∏—Ç—å –∑–∞:

1. **–õ–æ–≥–∏ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è**:
```bash
ssh root@85.202.192.68
docker compose -f docker-compose.prod.yml logs psychotest --tail=100 -f
```

2. **–ú–µ—Ç—Ä–∏–∫–∏ —Å–µ—Ä–≤–µ—Ä–∞**:
```bash
ssh root@85.202.192.68
docker stats
```

3. **–î–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å**:
- https://heartofzha.ru/api/health
- https://heartofzha.ru/egg

## üéâ –ì–æ—Ç–æ–≤–æ!

–ü–æ—Å–ª–µ –≤—Å–µ—Ö –ø—Ä–æ–≤–µ—Ä–æ–∫ egg –ø—Ä–æ–µ–∫—Ç —É—Å–ø–µ—à–Ω–æ –∏–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞–Ω –∏ —Ä–∞–±–æ—Ç–∞–µ—Ç –Ω–∞ –ø—Ä–æ–¥–∞–∫—à–µ–Ω–µ!

## üìù –ü–æ–ª–µ–∑–Ω—ã–µ –∫–æ–º–∞–Ω–¥—ã

```bash
# –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç—å —Ç–æ–ª—å–∫–æ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ
docker compose -f docker-compose.prod.yml restart psychotest

# –ü–æ—Å–º–æ—Ç—Ä–µ—Ç—å –ª–æ–≥–∏
docker compose -f docker-compose.prod.yml logs psychotest --tail=200

# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –∑–¥–æ—Ä–æ–≤—å–µ
curl http://localhost:3000/api/health

# –ó–∞–π—Ç–∏ –≤ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä
docker compose -f docker-compose.prod.yml exec psychotest sh

# –ü–æ—Å–º–æ—Ç—Ä–µ—Ç—å –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è
docker compose -f docker-compose.prod.yml exec psychotest env | grep JWT
```

